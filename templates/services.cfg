{% for host in groups['all'] %}
{% if "nagios_service_checks" in hostvars[host] and hostvars[host]['nagios_service_checks']|length > 0 %}
{# the "ping" check is handled separately, by defining hosts with check_command #}
{% for check in hostvars[host]['nagios_service_checks'].split(' ') if not check=="ping" %}
define service {
  use  local-service;
  host_name            {{host}};
  service_description  {{nagios_available_service_checks[check].description}};
  check_command        {{nagios_available_service_checks[check].command}};
}
{% endfor %}
{% endif %}
{% endfor %}
